<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Update Hosts via Ansible to Mitigate Bash "Shellshock" Vulnerability | Nairobi GNU/Linux Users Group
</title>
  <link rel="canonical" href="/2014/09/ansible-shellshock.html">

    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  
  <meta name="description" content="Patching your systems is painlessly easy if you manage your server infrastructure with something like Ansible.">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/profile.png alt="Nairobi GNU/Linux Users Group">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">Nairobi GNU/Linux Users Group</a></h1>
      <p class="text-muted">A lively community of GNU/Linux enthusiasts</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://web.libera.chat/?channels=#nairobilug" target="_blank">IRC</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="/pages/about-us.html">About Us</a></li>
            <li class="list-inline-item"><a href="/pages/code-of-conduct.html">Code of Conduct</a></li>
            <li class="list-inline-item"><a href="/pages/contact.html">Contact</a></li>
            <li class="list-inline-item"><a href="/pages/mailing-list.html">Mailing List</a></li>
            <li class="list-inline-item"><a href="/pages/meetups.html">Meetups</a></li>
            <li class="list-inline-item"><a href="/pages/software.html">Software</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/nairobilug" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-twitter" href="https://twitter.com/nairobilug" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Update Hosts via Ansible to Mitigate Bash "Shellshock" Vulnerability
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2014-09-29T10:40:00+03:00">
          <i class="fa fa-clock-o"></i>
          Mon 29 September 2014
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="/category/linux.html">Linux</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-user-o"></i>
              <a href="/author/alan-orth.html">Alan Orth</a>          </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="/tag/linux.html">#linux</a>,               <a href="/tag/ansible.html">#ansible</a>,               <a href="/tag/bash.html">#bash</a>,               <a href="/tag/security.html">#security</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>On September 24, 2014 someone <a href="http://seclists.org/oss-sec/2014/q3/649" title="CVE-2014-6271: remote code execution through bash">posted</a> on the oss-sec mailing list about a <code>bash</code> vulnerability that likely affects several decades of <code>bash</code> versions (something like <code>1.14</code> - <code>4.3</code>!). The vulnerability — aptly named "Shellshock" — can lead to remote code execution on un-patched hosts, for example <a href="http://www.nimbo.com/blog/shellshock-heartbleed-2-0">web servers parsing HTTP environment variables via CGI GET requests</a>, <a href="https://community.qualys.com/blogs/laws-of-vulnerabilities/2014/09/24/bash-shellshock-vulnerability" title="BASH Shellshock vulnerability - Update3">sshd configurations using <code>ForceCommand</code></a>, <a href="https://www.trustedsec.com/september-2014/shellshock-dhcp-rce-proof-concept/" title="Shellshock DHCP RCE PoC">DHCP clients</a>, etc.</p>
<p>Anyways, I'll leave the infosec community to <a href="https://www.dfranke.us/posts/2014-09-27-shell-shock-exploitation-vectors.html" title="Shell Shock Exploitation Vectors">expound on attack vectors</a>. The point of this post is really to illustrate that you should be using an infrastructure orchestration tool like <a href="http://www.ansible.com/home" title="Ansible homepage">Ansible</a> to manage your servers.</p>
<h3>Painless Patching With Ansible</h3>
<p>Patching your systems is painlessly easy if you manage your server infrastructure with something like Ansible. Using a one-off command you can easily update all "web" servers, for example:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span>apt<span class="w"> </span>-a<span class="w"> </span><span class="s2">"name=bash state=latest update_cache=yes"</span><span class="w"> </span>-K<span class="w"> </span>-s
</code></pre></div>
<p>That's great, but what if you have both Ubuntu and CentOS hosts in the "web" group? CentOS doesn't use <code>apt</code> for package management, so this has effectively only updated hosts running Debian-family GNU/Linux distros.</p>
<h3>Playbooks: The Power of Ansible</h3>
<p>When you have more than a handful of servers, the combinations of DNS names, IP addresses, roles, and distros becomes overwhelming. With Ansible you define your inventory of hosts, allocate them into groups, and then write "playbooks" to mold your servers into functional roles, ie web, database, compute, proxy, etc servers; the <a href="https://xkcd.com/910/" title="XKCD coming about naming servers">personal relationship</a> between sysadmin and server is gone.</p>
<p>Here's a simple playbook I wrote which takes into account the different OS families in our infrastructure and updates the <code>bash</code> package on each host.</p>
<p><em>shellshock.yml</em>:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># To update hosts for "Shellshock" bash vulnerability</span>
<span class="c1"># See: https://en.wikipedia.org/wiki/Shellshock_(software_bug)</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">sudo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update on Debian-based distros</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name=bash state=latest update_cache=yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == "Debian"</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update on RedHat-based distros</span>
<span class="w">      </span><span class="nt">yum</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name=bash state=latest</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == "RedHat"</span>

<span class="c1"># vim: set sw=2 ts=2:</span>
</code></pre></div>
<p>And then run the playbook with:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>ansible-playbook<span class="w"> </span>shellshock.yml<span class="w"> </span>-K<span class="w"> </span>-s
</code></pre></div>
<p>In our case we patched twenty-five CentOS 6.x, Debian 6, Debian 7, Ubuntu 12.04, and Ubuntu 14.04 hosts living locally, in Amazon EC2, and in Linode. With one command. In less than five minutes!</p>
<h3>Stay Vigilant!</h3>
<p>Vendors started pushing patched versions of <code>bash</code> on September 26th, two days after the initial disclosure. Two days after those patched versions were released there were <a href="http://lcamtuf.blogspot.com/2014/09/bash-bug-apply-unofficial-patch-now.html" title="Bash bug: apply Florian">new variations of this bug discovered</a>, and new packages issued (and we patched our systems again!).</p>
<p>As of now, five days after initial disclosure, there exist five <abbr title="Common Vulnerabilities and Exposures">CVE</abbr> identifiers for this bug! So keep an eye on social media (<a href="https://twitter.com/search?q=%23shellshock" title="#shellshock on Twitter">#shellshock</a>?), <a href="https://news.ycombinator.com/" title="Hacker News">Hacker News</a>, and <a href="https://shellshocker.net/" title="Shellshock monitoring">sites monitoring this bug</a>, because more new vectors may emerge!</p>
<p>This was <a href="https://mjanja.ch/2014/09/update-hosts-via-ansible-to-mitigate-bash-shellshock-vulnerability/">originally posted</a> on my personal blog; re-posted here for posterity.</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>