<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Using Swiftclient for Object Storage on OpenStack | Nairobi GNU/Linux Users Group
</title>
  <link rel="canonical" href="/2014/07/swiftclient-openstack.html">

    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  
  <meta name="description" content="Using swiftclient to backup data to OpenStack Swift object storage.">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/profile.png alt="Nairobi GNU/Linux Users Group">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">Nairobi GNU/Linux Users Group</a></h1>
      <p class="text-muted">A lively community of GNU/Linux enthusiasts</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://web.libera.chat/?channels=#nairobilug" target="_blank">IRC</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="/pages/about-us.html">About Us</a></li>
            <li class="list-inline-item"><a href="/pages/code-of-conduct.html">Code of Conduct</a></li>
            <li class="list-inline-item"><a href="/pages/contact.html">Contact</a></li>
            <li class="list-inline-item"><a href="/pages/mailing-list.html">Mailing List</a></li>
            <li class="list-inline-item"><a href="/pages/meetups.html">Meetups</a></li>
            <li class="list-inline-item"><a href="/pages/software.html">Software</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/nairobilug" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-twitter" href="https://twitter.com/nairobilug" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Using Swiftclient for Object Storage on OpenStack
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2014-07-29T19:40:00+03:00">
          <i class="fa fa-clock-o"></i>
          Tue 29 July 2014
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="/category/linux.html">Linux</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-user-o"></i>
              <a href="/author/alan-orth.html">Alan Orth</a>          </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="/tag/linux.html">#linux</a>,               <a href="/tag/openstack.html">#openstack</a>,               <a href="/tag/swift.html">#swift</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>I wanted to play with my new account on East African OpenStack provider <a href="http://kili.io/">Kili.io</a>, specifically to use the OpenStack Swift object storage to do periodic backups from my desktop. I'd used tools like <a href="http://s3tools.org/s3cmd">s3cmd</a> to do backups to Amazon S3 object storage, but it doesn't seem to work with OpenStack's <a href="http://docs.openstack.org/developer/swift/">Swift</a>.</p>
<p><a href="https://www.swiftstack.com/docs/integration/python-swiftclient.html">python-swiftclient</a> seems to be the answer. These are my notes from getting it set up to backup some data from my desktop to my shiny new OpenStack provider.</p>
<h3>See Also</h3>
<p>Related links and documentation:</p>
<ul>
<li><a href="http://docs.openstack.org/grizzly/openstack-object-storage/admin/content/swift-cli-basics.html">Swift CLI Basic</a></li>
<li><a href="http://docs.openstack.org/user-guide/content/managing-openstack-object-storage-with-swift-cli.html">Manage objects and containers</a></li>
</ul>
<h2>Download RC File</h2>
<p>This is actually the trickiest part of this whole exercise (you're welcome!). For an outsider, the OpenStack API jargon is a bit overwhelming.  Luckily, I found that OpenStack provides a shell init script which will set all the shell environment variables you need to get started with <code>swiftclient</code> (and presumably other OpenStack tools).</p>
<p>In the dashboard, navigate to <code>Project -&gt; Compute -&gt; Access &amp; Security -&gt; Download OpenStack RC File</code>.  We'll need this later.</p>
<h2>Create and Prepare virtualenv</h2>
<p>There's no <code>swiftclient</code> package in my GNU/Linux distribution, so I decided to just install it into a virtual environment straight from pypi/pip.</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>mkvirtualenv<span class="w"> </span>-p<span class="w"> </span><span class="sb">`</span>which<span class="w"> </span>python2<span class="sb">`</span><span class="w"> </span>swift
<span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>python-swiftclient<span class="w"> </span>python-keystoneclient
</code></pre></div>
<h2>Setup the Environment</h2>
<p>Source the environment RC script you downloaded from the OpenStack dashboard:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>.<span class="w"> </span>~/Downloads/aorth-openrc.sh
</code></pre></div>
<p>It will prompt you for your OpenStack dashboard password.</p>
<h2>Test</h2>
<p>Check if the settings are correct:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>swift<span class="w"> </span>stat
<span class="go">       Account: AUTH_8b0c9cff5d094829b0cf7606a0390c1a</span>
<span class="go">    Containers: 0</span>
<span class="go">       Objects: 0</span>
<span class="go">         Bytes: 0</span>
<span class="go"> Accept-Ranges: bytes</span>
<span class="go">        Server: nginx/1.4.7</span>
<span class="go">    Connection: keep-alive</span>
<span class="go">   X-Timestamp: 1406586841.02692</span>
<span class="go">    X-Trans-Id: tx5d47eff065074335a3a9f-0053d7c93e</span>
<span class="go">  Content-Type: text/plain; charset=utf-8</span>
</code></pre></div>
<p>This means the API key and all other settings are ok, and authentication was successful; you're now ready to use OpenStack CLI tools.</p>
<h2>Create a Container</h2>
<p>You could create a container in the OpenStack dashboard (<code>Object Store -&gt; Containers -&gt; Create Container</code>), but it's much nicer to be able to do this from the commandline using the API.</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>swift<span class="w"> </span>post<span class="w"> </span>Documents
<span class="gp">$ </span>swift<span class="w"> </span>list
<span class="go">Documents</span>
</code></pre></div>
<h2>Upload Files</h2>
<p>My use case is to backup Documents from my desktop.</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>~/Documents
<span class="gp">$ </span>swift<span class="w"> </span>upload<span class="w"> </span>Documents<span class="w"> </span>*
</code></pre></div>
<p><strong>Note:</strong> I <code>cd</code> into the directory I want to upload first, because I found that if I wasn't <em>inside</em> it, I would end up with another layer of hierarchy in my container itself, ie <code>Documents/Documents</code>.</p>
<p>Check the status of the container:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>swift<span class="w"> </span>stat<span class="w"> </span>Documents
<span class="go">       Account: AUTH_9b0a8aff5d584828b5af7656c0385a1c</span>
<span class="go">     Container: Documents</span>
<span class="go">       Objects: 2691</span>
<span class="go">         Bytes: 262663872</span>
<span class="go">      Read ACL:</span>
<span class="go">     Write ACL:</span>
<span class="go">       Sync To:</span>
<span class="go">      Sync Key:</span>
<span class="go"> Accept-Ranges: bytes</span>
<span class="go">        Server: nginx/1.4.7</span>
<span class="go">    Connection: keep-alive</span>
<span class="go">   X-Timestamp: 1406586841.13379</span>
<span class="go">    X-Trans-Id: txbf31671156c64147bd9ad-0053d767c9</span>
<span class="go">  Content-Type: text/plain; charset=utf-8</span>
</code></pre></div>
<p>Looks good! ~250MB of data in my <code>Documents</code> container now, which just about matches the size of the folder on my disk.</p>
<h2>Bonus Points</h2>
<p>Bonus points and future research:</p>
<ul>
<li>If I want to call this from a cron job, how do I enter my password?</li>
<li>How do I encrypt my backups?</li>
<li>Use <code>--skip-identical</code> to only sync new files</li>
<li>What other interfaces are there to this storage, ie can I point a music player at this?</li>
<li>Play with public/private read/write ACLs</li>
</ul>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>