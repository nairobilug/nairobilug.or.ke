<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Building a Pentest Lab With Docker | Nairobi GNU/Linux Users Group
</title>
  <link rel="canonical" href="/2020/06/Lightweight lab entirely in Docker without Vmware or VirtualBox.html">

    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  
  <meta name="description" content="Lightweight penetration testing lab inside docker GUI support">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/profile.png alt="Nairobi GNU/Linux Users Group">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">Nairobi GNU/Linux Users Group</a></h1>
      <p class="text-muted">A lively community of GNU/Linux enthusiasts</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://web.libera.chat/?channels=#nairobilug" target="_blank">IRC</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="/pages/about-us.html">About Us</a></li>
            <li class="list-inline-item"><a href="/pages/code-of-conduct.html">Code of Conduct</a></li>
            <li class="list-inline-item"><a href="/pages/contact.html">Contact</a></li>
            <li class="list-inline-item"><a href="/pages/mailing-list.html">Mailing List</a></li>
            <li class="list-inline-item"><a href="/pages/meetups.html">Meetups</a></li>
            <li class="list-inline-item"><a href="/pages/software.html">Software</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/nairobilug" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-twitter" href="https://twitter.com/nairobilug" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Building a Pentest Lab With Docker
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2020-06-13T14:30:00+03:00">
          <i class="fa fa-clock-o"></i>
          Sat 13 June 2020
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="/category/linux.html">Linux</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-user-o"></i>
              <a href="/author/ian-muchina.html">Ian Muchina</a>          </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="/tag/docker.html">#Docker</a>,               <a href="/tag/infosec.html">#Infosec</a>          </li>
      </ul>
    </header>
    <div class="content">
      <h2>What is Docker?</h2>
<p><img alt="Docker Logo" class="img-fluid" src="/images/docker-pentest-lab/docker.svg"/>
Docker is a container platform that is similar to a Hypervisor like Virtualbox. Docker uses less storage and RAM and are portable.</p>
<p>Docker can run on: 
- Linux
- Windows
- Mac OS</p>
<p>In this article I will go over how to set up a penetration testing lab entirely in docker</p>
<p>It will consist of two types of containers.</p>
<ul>
<li>Attacker Machine</li>
<li>Target Machine</li>
</ul>
<h2>Installation on Linux</h2>
<h4>The Convenience Script</h4>
<p>Update: You can install Docker quickly and non interactively when you use the convenience scripts provided by Docker at <a href="https://get.docker.com">get.docker.com</a></p>
<p>Installation is then done by :</p>
<div class="highlight"><pre><span></span><code><span class="go">curl -fsSL https://get.docker.com -o get-docker.sh</span>
<span class="go">sh get-docker.sh</span>
</code></pre></div>
<h4>Debian based distros</h4>
<p>Anything that uses <code>apt</code> to install software is Debian based.
Find a complete list <a href="https://en.wikipedia.org/wiki/List_of_Linux_distributions#Debian-based">here</a></p>
<p>To install on Ubuntu :</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo apt install docker.io
</code></pre></div>
<hr/>
<h2>Docker on Windows</h2>
<p>To run docker in windows, install <a href="https://docs.docker.com/docker-for-windows/install/">Docker desktop</a>.</p>
<p><img alt="Windows 10 Logo" class="img-fluid" src="/images/docker-pentest-lab/windows10.svg"/></p>
<p>Docker Desktop is an awesome app with a graphical interface. It can run Linux containers from windows. However, there's one major deal-breaker.</p>
<p>Docker Desktop cannot co-exist with VirtualBox or VMware, because it requires Hyper-V to run Linux containersüò§<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<blockquote class="blockquote">
<p>Hyper-V is Microsoft's hardware virtualization product</p>
</blockquote>
<p>As a workaround. 
 * Use <a href="Use https://docs.docker.com/toolbox/">Docker Toolbox</a> üë®‚Äçüíª
 * Learn Hyper-V üìö
 * Install Linux ü§∑‚Äç‚ôÄÔ∏è </p>
<blockquote class="blockquote">
<p>This is also the same reason <a href="https://blogs.windows.com/windowsdeveloper/2016/07/22/fun-with-the-windows-subsystem-for-linux/">WSL</a> cannot co-exist with VMware/Virtualbox.</p>
</blockquote>
<p>Now I'm starting to see why people hate Microsoft. They lock users to their ecosystem.</p>
<hr/>
<h2>Hello World</h2>
<p>After you have installed docker, run this command as a test</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker run hello-world
</code></pre></div>
<p>If it completes successfully, you can follow along</p>
<p><img alt="Server status" class="img-fluid" src="/images/docker-pentest-lab/Server status-pana.svg"/></p>
<h2>The Network</h2>
<p>The network will be called <code>vulnerable</code>. It will have a 10.0.0/24 subnet</p>
<p>Create it with this command</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker network create vulnerable --attachable --subnet <span class="m">10</span>.0.0.0/24
</code></pre></div>
<h2>Attacker Container</h2>
<p>For this, I will use Parrot OS. It's docker images are better Kali Linux Images.</p>
<p><img alt="Cyber photo" class="img-fluid" src="/images/docker-pentest-lab/cyberr.svg"/></p>
<p>First download the Parrot OS Docker image. This command will take a while depending on your internet connection. </p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>docker pull parrotsec/security:latest
</code></pre></div>
<p>Create and run the container .</p>
<div class="highlight"><pre><span></span><code>sudo docker run <span class="se">\</span>
    --name parrot <span class="se">\</span>
    -it <span class="se">\</span>
    --hostname parrot <span class="se">\</span>
    --network vulnerable <span class="se">\</span>
    --ip<span class="o">=</span><span class="s2">"10.0.0.2"</span> <span class="se">\</span>
    --env <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$DISPLAY</span> <span class="se">\</span>
    -v /dev/shm:/dev/shm <span class="se">\</span>
    --device /dev/snd <span class="se">\</span>
    --device /dev/dri <span class="se">\</span>
    --mount <span class="nv">type</span><span class="o">=</span>bind,src<span class="o">=</span>/tmp/.X11-unix,dst<span class="o">=</span>/tmp/.X11-unix <span class="se">\</span>
    parrotsec/security:latest <span class="se">\</span>
    /bin/bash 
</code></pre></div>
<p>All tools available in Parrot OS are now an <code>apt-get</code> away.</p>
<p>Use this command to restart the parrot OS container after a reboot.</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker start -a parrot
</code></pre></div>
<h3>Target container:Metasploitable2</h3>
<p><img alt="Target" class="img-fluid" src="/images/docker-pentest-lab/Target-pana.svg"/></p>
<p>This is a very vulnerable test machine. It is what I recommend for anyone starting out.</p>
<p>Open another terminal and pull the metasploitable image. The image is around 500MB.</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>docker pull tleemcjr/metasploitable2
</code></pre></div>
<p>To run a metasploitable container:</p>
<div class="highlight"><pre><span></span><code>docker run <span class="se">\</span>
    -it <span class="se">\</span>
    --network vulnerable <span class="se">\</span>
    --ip<span class="o">=</span><span class="s2">"10.0.0.3"</span> <span class="se">\</span>
    --name metasploitable <span class="se">\</span>
    --hostname metasploitable2 <span class="se">\</span>
    tleemcjr/metasploitable2 <span class="se">\</span>
    bash
</code></pre></div>
<p>You should see a terminal prompt like this</p>
<div class="highlight"><pre><span></span><code><span class="gp">root@metasploitable2:/#</span>
</code></pre></div>
<p>Start the vulnerable services</p>
<div class="highlight"><pre><span></span><code><span class="gp">root@metasploitable2:/# </span>services.sh
</code></pre></div>
<p>You can now access metasploitable from <a href="http://10.0.0.3">10.0.0.3</a></p>
<p>If you want to stop the container, close the terminal with <code>CTRL + D</code></p>
<p>Run this command to start metasploitable again</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker start -a parrot
</code></pre></div>
<p>Then start the vulnerable services. </p>
<div class="highlight"><pre><span></span><code><span class="gp">root@metasploitable2:/# </span>services.sh
</code></pre></div>
<h4>Guides &amp; Tutorials</h4>
<p>There are tons of free guides out there on metasploitable. </p>
<p><img alt="Image of person Studying" class="img-fluid" src="/images/docker-pentest-lab/read.svg"/></p>
<ol>
<li><a href="https://www.exploit-db.com/docs/english/44040-the-easiest-metasploit-guide-you%E2%80%99ll-ever-read.pdf">The Easiest Metasploit Guide You‚Äôll Ever Read</a></li>
<li><a href="https://www.offensive-security.com/metasploit-unleashed/">Metasploit Unleashed</a></li>
<li><a href="https://metasploit.help.rapid7.com/docs/metasploitable-2-exploitability-guide">Metasploitable 2 Exploitability Guide</a></li>
<li><a href="https://www.youtube.com/results?search_query=metasploitable">Youtube Tutorials</a></li>
</ol>
<p>If you don't know what guide to use, I recommend <a href="https://metasploit.help.rapid7.com/docs/metasploitable-2-exploitability-guide">this one</a>.</p>
<h2>More vulnerable containers üßë‚Äçüíª</h2>
<p><img alt="More Cyber" class="img-fluid" src="/images/docker-pentest-lab/hacker.svg"/></p>
<p>You can extend the lab with any of these containers depending on your learning goal.</p>
<h3>OWASP Juiceshop</h3>
<p>This container focusses on web application security.</p>
<p><img alt="Juiceshop Logo" class="img-fluid" src="/images/docker-pentest-lab/juiceshop.svg"/></p>
<p>To create and start the juiceshop container for the first time</p>
<div class="highlight"><pre><span></span><code>docker run -d <span class="se">\</span>
    --name juiceshop <span class="se">\</span>
    --network vulnerable <span class="se">\</span>
    --ip<span class="o">=</span><span class="s2">"10.0.0.6"</span> <span class="se">\</span>
    bkimminich/juice-shop
</code></pre></div>
<p>Check if it is running</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>docker ps 
</code></pre></div>
<p>Access the web interface from this URL</p>
<p><a href="http://10.0.0.6:3000/">http://10.0.0.6:3000/</a></p>
<p>Stop the container when you're done</p>
<div class="highlight"><pre><span></span><code><span class="go">docker stop juiceshop</span>
</code></pre></div>
<p>Start the container again</p>
<div class="highlight"><pre><span></span><code><span class="go">docker start juiceshop</span>
</code></pre></div>
<h5>Juiceshop Guides</h5>
<ul>
<li><a href="https://pwning.owasp-juice.shop/">Pwning Juiceshop</a></li>
<li><a href="https://www.youtube.com/results?search_query=owasp+juiceshop">Youtube Videos</a></li>
</ul>
<h4>OWASP Webgoat üêê</h4>
<p><a href="(https://owasp.org/www-project-webgoat/)">Webgoat</a> is a ctf-style vulnerable container focused on web application security.</p>
<p><img alt="goat-svg" class="img-fluid" src="/images/docker-pentest-lab/goat.svg"/></p>
<p>Create and run the container for the first time</p>
<div class="highlight"><pre><span></span><code>docker run  -d <span class="se">\</span>
    --name webgoat <span class="se">\</span>
    --network vulnerable <span class="se">\</span>
    --ip<span class="o">=</span><span class="s2">"10.0.0.4"</span> <span class="se">\</span>
    -e <span class="nv">TZ</span><span class="o">=</span><span class="k">$(</span>cat /etc/timezone<span class="k">)</span> <span class="se">\</span>
    webgoat/goatandwolf
</code></pre></div>
<p>Access Webgoat and Webwolf from these URLs</p>
<p><a href="http://10.0.0.4:8080/WebGoat">10.0.0.4:8080/WebGoat</a></p>
<p><a href="http://10.0.0.4:9090/WebWolf">10.0.0.4:9090/WebWolf</a></p>
<p>To stop the container</p>
<div class="highlight"><pre><span></span><code><span class="go">docker stop webgoat</span>
</code></pre></div>
<p>To Start the container again.</p>
<div class="highlight"><pre><span></span><code><span class="go">docker start webgoat</span>
</code></pre></div>
<p>If you can't access the url, check if it is running.</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>docker ps -a
</code></pre></div>
<h3>Why I use docker for a pentest lab</h3>
<p>Two Operating systems make my computer painfully slow. Containers aren't resource-intensive and perform well. This fits my use case.</p>
<p><img alt="Lab.svg" class="img-fluid" src="/images/docker-pentest-lab/lab.svg"/></p>
<p>If you have RAM to spare then it's really not that much of a difference. </p>
<h2>When not to use Docker</h2>
<p>If you want to run Windows containers from a linux host, you are out of luck. You can run linux containers on Windows though</p>
<h3>Common Docker Commands</h3>
<p>Stop a container:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker stop containerName
</code></pre></div>
<p>Start a container </p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker start containerName 
</code></pre></div>
<p>List running  and stopped containers</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker ps -a
</code></pre></div>
<p>Spawn a bash shell in a running container</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>sudo docker <span class="nb">exec</span> -it containerName bash
</code></pre></div>
<p>Docker has tab completion for each of these commands.</p>
<h3>Graphical apps inside docker</h3>
<p>Sometimes you may want to run a GUI tool like firefox or burpsuite.</p>
<p>The Parrot OS commands above are already set for running graphical apps. You only need to install these packages</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>apt install hicolor-icon-theme <span class="se">\</span>
    libcanberra-gtk* libgl1-mesa-dri <span class="se">\</span>
    libgl1-mesa-glx libpangox-1.0-0 <span class="se">\</span>
    libpulse0 libv4l-0 fonts-symbola <span class="se">\ </span>
</code></pre></div>
<p>You can run a few commands to avoid some errors encountered when running GUI apps</p>
<h4>Burpsuite</h4>
<p>Burp Suite is a web app pentesting tool for monitoring http requests and responses.</p>
<p><img alt="Burpsuite Logo" class="img-fluid" src="/images/docker-pentest-lab/burp.svg"/></p>
<p>To install and run burpsuite inside the parrot os container.</p>
<div class="highlight"><pre><span></span><code><span class="gp"># </span>sudo apt update
<span class="gp"># </span>sudo apt install burpsuite
<span class="gp"># </span>java -jar -Xmx2G /usr/bin/burpsuite
</code></pre></div>
<p>You can then point your browser to use <code>10.0.0.2:8080</code> as the proxy and burp will intercept everything</p>
<h4>Firefox</h4>
<p>Firefox, is a free and open-source web browser.</p>
<p><img alt="Firefox Logo" class="img-fluid" src="/images/docker-pentest-lab/firefox.svg"/></p>
<p>To install and run firefox:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>apt install firefox ca-certificates 
</code></pre></div>
<h3>Credits</h3>
<ul>
<li>Illustrations from <a href="https://stories.freepik.com/">Freepik</a></li>
</ul>
<p><img alt="Stories by freepik" class="img-fluid" src="https://ianmuchina.com/assets/img/posts/freepik.svg"/></p>
<p>This was originaly posted on my blog at <a href="https://ianmuchina.com/">ianmuchina.com</a></p>
<h3>Further reading/research</h3>
<p>Jess Frazelle has written an awesome <a href="https://blog.jessfraz.com/post/docker-containers-on-the-desktop/">blog post</a> with details on running graphical apps inside Docker containers. She's also given this awesome <a href="https://youtu.be/cYsVvV1aVss">Talk/Demo</a> on running various applications and retro games inside docker containers.</p>
<h2>Footnotes</h2>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>Docker requires a Linux kernel to run Linux containers on Windows. Docker accomplishes this by running a Linux Virtual Machine inside Hyper-V. This is still more resource-efficient than full VM's. Plus there's the added benefit of running both Windows and Linux containers. This is not possible on Linux¬†<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">‚Ü©</a></p>
</li>
</ol>
</div>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>